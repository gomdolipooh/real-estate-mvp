<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Featured ë°ì´í„° í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Featured ë§¤ë¬¼ ë°ì´í„° í™•ì¸</h1>
    <div id="result" class="space-y-4"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCUOvPVhd1zgVOJq3a88MeE4Ew1QgB42xU",
      authDomain: "vision-ac00e.firebaseapp.com",
      projectId: "vision-ac00e",
      storageBucket: "vision-ac00e.firebasestorage.app",
      messagingSenderId: "973829787287",
      appId: "1:973829787287:web:3ca6b7f51dceda8eb123d2",
      measurementId: "G-71PFXDK6S4",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const resultDiv = document.getElementById("result");

    async function test() {
      try {
        resultDiv.innerHTML = '<p class="text-blue-600">ğŸ”„ Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì¤‘...</p>';

        const snap = await getDocs(collection(db, "listings"));

        const listings = snap.docs
          .map(doc => ({
            id: doc.id,
            ...doc.data()
          }))
          .filter(item => item.status === "published")
          .sort((a, b) => {
            const aTime = a.createdAt?.seconds || 0;
            const bTime = b.createdAt?.seconds || 0;
            return bTime - aTime;
          });

        console.log("ì „ì²´ ë§¤ë¬¼:", listings);

        let html = `<p class="text-green-600 font-bold">âœ… ì´ ${listings.length}ê°œ ë§¤ë¬¼ ë¡œë“œ ì™„ë£Œ</p><hr class="my-4">`;

        // Featured ë§¤ë¬¼ë§Œ í•„í„°ë§
        const featuredListings = listings.filter(l => l.featured);

        if (featuredListings.length === 0) {
          html += '<p class="text-red-600 font-bold">âŒ Featured ì„¤ì •ëœ ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤!</p>';
          html += '<p class="text-sm text-slate-600 mt-2">ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ â­ ë²„íŠ¼ì„ ëˆŒëŸ¬ TOP3 ì„¤ì •ì„ í•´ì£¼ì„¸ìš”.</p>';
        } else {
          html += `<p class="text-blue-600 font-bold mb-4">ğŸŒŸ Featured ì„¤ì •ëœ ë§¤ë¬¼: ${featuredListings.length}ê°œ</p>`;
          
          featuredListings.forEach(listing => {
            html += `
              <div class="bg-white p-4 rounded-lg shadow mb-4">
                <h3 class="font-bold text-lg mb-2">${listing.title}</h3>
                <p class="text-sm text-slate-600 mb-2">${listing.region} Â· ${listing.sizePyeong || '-'}í‰</p>
                <div class="bg-yellow-50 p-3 rounded">
                  <p class="font-semibold text-sm mb-1">Featured ì¹´í…Œê³ ë¦¬:</p>
                  <pre class="text-xs bg-slate-800 text-green-400 p-2 rounded overflow-x-auto">${JSON.stringify(listing.featured, null, 2)}</pre>
                </div>
              </div>
            `;
          });
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
        const categories = {
          small: "ğŸ  ì†Œí˜• í‰ìˆ˜",
          medium: "ğŸ­ ì¤‘í˜• í‰ìˆ˜",
          large: "ğŸ¢ ëŒ€í˜• í‰ìˆ˜",
          cosmetics: "ğŸ’„ í™”ì¥í’ˆ ê³µì¥",
          metal: "âš™ï¸ ê¸ˆì†Â·ê¸°ê³„Â·ë¶€í’ˆ",
          food: "ğŸ” ì‹í’ˆ ê³µì¥"
        };

        html += '<hr class="my-6"><h2 class="text-xl font-bold mb-4">ì¹´í…Œê³ ë¦¬ë³„ Featured ë§¤ë¬¼</h2>';

        Object.entries(categories).forEach(([key, label]) => {
          const categoryListings = listings
            .filter(l => l.featured && l.featured[key])
            .sort((a, b) => a.featured[key] - b.featured[key]);

          html += `
            <div class="mb-4">
              <h3 class="font-bold mb-2">${label}</h3>
              ${categoryListings.length === 0 
                ? '<p class="text-slate-500 text-sm ml-4">ì„¤ì •ëœ ë§¤ë¬¼ ì—†ìŒ</p>'
                : `<ul class="ml-4 space-y-1">
                    ${categoryListings.map(l => 
                      `<li class="text-sm">
                        <span class="inline-block w-8 text-center bg-blue-100 rounded px-2 py-1 mr-2">${l.featured[key]}ìœ„</span>
                        ${l.title}
                      </li>`
                    ).join('')}
                  </ul>`
              }
            </div>
          `;
        });

        resultDiv.innerHTML = html;
      } catch (error) {
        console.error("ì—ëŸ¬:", error);
        resultDiv.innerHTML = `<p class="text-red-600">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
      }
    }

    test();
  </script>
</body>
</html>

